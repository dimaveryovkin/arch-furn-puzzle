<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–°—Ç–∏–ª—å–Ω–∞ –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∞</title>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GY0ZMJJ1Q9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-GY0ZMJJ1Q9');
    </script>

    <style>
        :root {
            --drop-text: "–ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å —Å—Ç—ñ–ª–µ—Ü—å";
            --bg-color: #F7F7F5;
            --card-bg: #FFFFFF;
            --text-main: #37474F;
            --text-secondary: #78909C;
            --accent-color: #546E7A;
            --btn-gradient: linear-gradient(135deg, #455A64 0%, #263238 100%);
            --success-color: #66BB6A;
            --error-color: #EF5350;
            --panel-bg: #263238;
            --shadow-soft: 0 4px 20px rgba(0,0,0,0.03);
            --shadow-card: 0 1px 3px rgba(0,0,0,0.05);
            --radius-main: 12px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            -webkit-font-smoothing: antialiased;
        }

        /* --- HEADER --- */
        #header {
            display: flex;
            flex-direction: column;
            padding: 20px 24px;
            background: var(--bg-color);
            z-index: 10;
            position: relative; 
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        
        .header-top {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            width: 100%;
        }
        
        .header-desc {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 10px;
            line-height: 1.5;
            max-width: 800px;
            font-weight: 400;
        }

        .lang-switch { 
            font-size: 13px; 
            font-weight: 600; 
            cursor: pointer; 
            color: #B0BEC5; 
            letter-spacing: 0.5px;
            transition: color 0.2s;
            pointer-events: auto; 
        }
        .lang-switch:hover { color: var(--text-main); }
        .lang-switch.active { color: var(--text-main); text-decoration: none; border-bottom: 2px solid var(--text-main); padding-bottom: 2px;}
        .lang-separator { margin: 0 10px; color: #CFD8DC; }

        /* --- VIEWS --- */
        #game-view { display: flex; flex-direction: column; flex: 1; }
        #results-view { display: none; flex-direction: column; flex: 1; padding: 24px; padding-bottom: 100px; }

        /* --- GAME GRID --- */
        #buildings-container {
            flex: 1;
            display: grid;
            padding: 24px;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px;
            padding-bottom: 250px; 
        }

        .card {
            background: var(--card-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            border-radius: var(--radius-main);
            box-shadow: var(--shadow-card);
            padding: 20px;
            border: 1px solid rgba(0,0,0,0.02);
        }

        .building-img {
            width: 100%;
            aspect-ratio: 16 / 10;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 16px;
            pointer-events: none;
            -webkit-user-drag: none;
            background-color: #ECEFF1;
            filter: brightness(0.98);
        }

        .chair-drop-zone {
            height: 180px;
            border: 1px dashed #B0BEC5;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #FAFAFA;
            margin-bottom: 16px;
            position: relative;
            width: 100%;
            transition: all 0.3s ease;
        }
        .chair-drop-zone:not(.has-item)::after {
            content: var(--drop-text);
            position: absolute;
            color: #CFD8DC;
            font-size: 13px;
            pointer-events: none;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .chair-drop-zone.drag-over { 
            background-color: rgba(84, 110, 122, 0.05); 
            border-color: var(--accent-color); 
        }
        .chair-drop-zone.has-item { 
            border-style: solid; 
            border-color: transparent; 
            background-color: #fff; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .style-input {
            padding: 12px;
            border: 1px solid #CFD8DC;
            border-radius: 6px;
            font-size: 15px;
            width: 100%;
            text-align: center;
            background: #fff;
            color: var(--text-main);
            -webkit-user-select: text;
            user-select: text;
            transition: all 0.2s;
            outline: none;
            box-sizing: border-box; /* –í–∞–∂–ª–∏–≤–æ –¥–ª—è –≤—ñ–¥—Å—Ç—É–ø—ñ–≤ */
        }
        .style-input:focus {
            border-color: var(--accent-color);
            background: #fff;
        }

        /* --- SUBMIT BUTTON --- */
        #submit-container {
            grid-column: 1 / -1;
            display: flex;
            justify-content: center;
            margin-top: 40px;
            margin-bottom: 20px;
            width: 100%;
        }
        .action-btn {
            background: var(--btn-gradient);
            color: white;
            border: none;
            padding: 14px 32px;
            font-size: 15px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(55, 71, 79, 0.2);
            transition: transform 0.2s, box-shadow 0.2s, opacity 0.2s, background 0.2s;
            pointer-events: auto;
            text-align: center;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            -webkit-appearance: none;
        }
        .action-btn:hover { 
            transform: translateY(-1px); 
            box-shadow: 0 6px 20px rgba(55, 71, 79, 0.3); 
        }
        .action-btn:active { transform: scale(0.98); }
        
        /* –°—Ç–∞–Ω –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—ó –∫–Ω–æ–ø–∫–∏ */
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
            box-shadow: none;
            background: #CFD8DC; /* –°—ñ—Ä–∏–π —Ñ–æ–Ω */
        }

        #footer-game {
            grid-column: 1 / -1;
            text-align: right;
            color: #B0BEC5;
            font-size: 11px;
            margin-top: 10px;
            padding-right: 10px;
            font-weight: 500;
            width: 100%;
        }

        /* --- POOL (Compact Modern Drawer) --- */
        #chairs-pool {
            position: fixed;
            bottom: 0; left: 0; width: 100%; 
            height: 190px; 
            background-color: var(--panel-bg);
            padding-top: 10px; 
            padding-bottom: 10px;
            display: flex; align-items: flex-start;
            overflow-x: auto; z-index: 1000;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            scrollbar-width: thin;
            scrollbar-color: #546E7A var(--panel-bg);
        }
        
        .chair-item {
            min-width: 162px; width: 162px; height: 162px;
            margin: 0 10px; 
            cursor: grab; 
            background: #fff; 
            border-radius: 8px; 
            padding: 5px;
            object-fit: contain; 
            box-sizing: border-box; 
            pointer-events: auto;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .chair-item:active { cursor: grabbing; transform: scale(0.95); }
        
        .chair-item.dragging-mobile {
            position: fixed; z-index: 9999; opacity: 0.95; pointer-events: none;
            width: 140px; height: 140px; border-radius: 50%; 
            border: 2px solid var(--accent-color);
            background: #fff; 
            transform: translate(-50%, -50%); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        /* --- RESULTS STYLES --- */
        .score-card {
            background: #fff; padding: 32px; border-radius: 16px;
            text-align: center; margin-bottom: 30px;
            box-shadow: var(--shadow-soft);
            border-top: 4px solid var(--accent-color);
        }
        .score-card.mobile-only {
            display: none; 
            margin-top: 20px;
        }

        .score-title { font-size: 36px; font-weight: 800; color: var(--text-main); margin-bottom: 8px; letter-spacing: -0.5px; }
        .score-text { font-size: 16px; color: var(--text-secondary); line-height: 1.5; margin-bottom: 10px; }
        .score-emojis { font-size: 28px; margin-bottom: 24px; letter-spacing: 5px; }

        .result-item {
            background: #fff; border-radius: 12px; padding: 20px; margin-bottom: 24px;
            box-shadow: var(--shadow-card);
            border-left: 4px solid transparent;
        }
        .result-item.correct { border-left-color: var(--success-color); }
        .result-item.incorrect { border-left-color: var(--error-color); }
        
        .result-header { font-size: 18px; font-weight: 700; margin-bottom: 16px; color: var(--text-main); }
        
        .result-grid {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 16px;
            align-items: end;
        }
        .res-img-block { text-align: center; font-size: 10px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 700;}
        .res-img-block div:last-child { margin-top: 6px; }

        .res-img { 
            width: auto; height: 240px; max-width: 100%;
            object-fit: contain; background: #fff; border-radius: 4px; 
            border: 1px solid #ECEFF1; padding: 4px; display: block; margin: 0 auto;
        }
        .b-img { width: 100%; height: auto; aspect-ratio: 16/10; object-fit: cover; border: none; padding: 0; }
        
        .result-details { font-size: 14px; line-height: 1.6; color: var(--text-main); border-top: 1px solid #ECEFF1; padding-top: 12px;}
        .result-details b { color: var(--accent-color); font-weight: 600; }
        .user-input-display { font-style: italic; color: var(--text-secondary); margin-bottom: 8px; font-size: 13px;}

        /* --- MODAL FOR NAME --- */
        #modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(38, 50, 56, 0.85); /* –ó–∞—Ç–µ–º–µ–Ω–∏–π —Ñ–æ–Ω */
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }
        
        .modal-box {
            background: #fff;
            padding: 30px;
            border-radius: 16px;
            width: 90%;
            max-width: 420px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 20px;
            line-height: 1.4;
        }
        
        .modal-input {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            border: 2px solid #CFD8DC;
            border-radius: 8px;
            margin-bottom: 24px;
            outline: none;
            text-align: center;
            box-sizing: border-box;
            transition: border-color 0.2s;
        }
        .modal-input:focus {
            border-color: var(--accent-color);
        }

        /* --- MOBILE ADAPTATION --- */
        @media (max-width: 600px) {
            #buildings-container { 
                padding: 0; 
                gap: 0; 
                display: block; 
                padding-bottom: 150px !important; 
            }
            
            .card { 
                border-radius: 0; 
                border: none;
                box-shadow: none; 
                margin-bottom: 0; 
                width: 100%; 
                padding: 0 0 40px 0; 
                background: #fff;
            }
            .card + .card { 
                border-top: 12px solid #ECEFF1; 
            }
            
            .building-img { 
                border-radius: 0; 
                margin-bottom: 24px; 
                width: 100%; 
                box-shadow: none; 
            }
            
            .chair-drop-zone, .style-input { 
                width: 90%; 
                margin: 0 auto 16px auto; 
            }
            
            .result-grid { grid-template-columns: 1fr; gap: 20px; }
            .res-img { height: 200px; }
            .b-img { width: 100%; aspect-ratio: 16/10; height: auto;}
            
            #footer-game { text-align: center; padding-right: 0; margin-bottom: 20px; margin-top: 20px;} 
            
            #header { padding: 15px 20px; }
            .header-desc { font-size: 13px; }

            #chairs-pool {
                height: 130px; 
                padding-top: 5px; 
                padding-bottom: 5px;
            }
            
            .chair-item {
                min-width: 115px; width: 115px; height: 115px; 
                margin: 5px;
            }

            .score-card.mobile-only {
                display: block;
            }
        }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="header">
        <div class="header-top">
            <div>
                <span class="lang-switch active" id="btn-ua" onclick="setLanguage('ua')">UA</span>
                <span class="lang-separator">|</span>
                <span class="lang-switch" id="btn-en" onclick="setLanguage('en')">EN</span>
            </div>
        </div>
        <div class="header-desc" id="page-desc">
            –†–∞–Ω—ñ—à–µ, —è–∫—â–æ –≤–∏ –ø–ª—É—Ç–∞–ª–∏ –±–∞—Ä–æ–∫–æ —Ç–∞ –º–æ–¥–µ—Ä–Ω, –¢–∞–Ω—è –æ–¥—Ä–∞–∑—É –≤—Ç—Ä–∞—á–∞–ª–∞ —ñ–Ω—Ç–µ—Ä–µ—Å –¥–æ –≤–∞—Å. –¢–µ–ø–µ—Ä –≤–∏–º–æ–≥–∏ –Ω–µ —Ç–∞–∫—ñ —Å—É–≤–æ—Ä—ñ, –ø—Ä–æ—Ç–µ –∫—Ä–∞—â–µ –Ω–µ —Ä–æ–∑—Å–ª–∞–±–ª—è—Ç–∏—Å—å. –î–ª—è –∫–æ–∂–Ω–æ—ó –±—É–¥—ñ–≤–ª—ñ –ø—ñ–¥–±–µ—Ä—ñ—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Å—Ç—ñ–ª–µ—Ü—å, —è–∫–∏–π –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏–º–µ —ó–π –ø–æ —Å—Ç–∏–ª—é.
        </div>
    </div>

    <div id="game-view">
        <div id="buildings-container">
            <div id="submit-container">
                <button class="action-btn" onclick="openNameModal()" id="submit-btn">–ß–∏ –≤–∞—Ä—Ç–∏–π/–∞ —è —É–≤–∞–≥–∏ –¢–∞–Ω—ñ</button>
            </div>
            <div id="footer-game">–ó—Ä–æ–±–ª–µ–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –¥–∞–≤–Ω—å–æ—ó –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∏ –≤—ñ–¥ arzamas</div>
        </div>
        
        <div id="chairs-pool" ondrop="dropToPool(event)" ondragover="allowDrop(event)">
            </div>
    </div>

    <!-- MODAL FOR NAME -->
    <div id="modal-overlay">
        <div class="modal-box">
            <div class="modal-title" id="modal-title-text">–ó–∞–ª–∏—à—Ç–µ –≤–∞—à–µ —ñ–º'—è (—â–æ–± –¢–∞–Ω—è –∑–Ω–∞–ª–∞ –ø—Ä–æ –≤–∞—Å)</div>
            <input type="text" class="modal-input" id="player-name" placeholder="–í–∞—à–µ —ñ–º'—è..." maxlength="40" oninput="checkNameInput()">
            <button class="action-btn" onclick="finishGame()" id="modal-btn" disabled>–î—ñ–∑–Ω–∞—Ç–∏—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
        </div>
    </div>

    <div id="results-view">
        <div class="score-card">
            <div class="score-title" id="score-val">0 / 16</div>
            <div class="score-text" id="score-msg">...</div>
            <div class="score-emojis" id="score-emojis"></div>
            <button class="action-btn" onclick="resetGame()" id="retry-btn">–ü—Ä–æ–π—Ç–∏ —â–µ —Ä–∞–∑</button>
        </div>
        
        <div id="results-list">
            </div>

        <div class="score-card mobile-only">
            <div class="score-title" id="score-val-bottom">0 / 16</div>
            <div class="score-text" id="score-msg-bottom">...</div>
            <div class="score-emojis" id="score-emojis-bottom"></div>
            <button class="action-btn" onclick="resetGame()" id="retry-btn-bottom">–ü—Ä–æ–π—Ç–∏ —â–µ —Ä–∞–∑</button>
        </div>
    </div>

    <script>
        // --- DATASET ---
        const gameDB = [
            { id: 1, styleUA: "–ì–æ—Ç–∏–∫–∞", styleEN: "Gothic", 
              archUA: "–ó–∞–º–æ–∫ –ê–ª—å–±—Ä–µ—Ö—Ç—Å–±—É—Ä–≥. –ú–∞–π—Å–µ–Ω, –ù—ñ–º–µ—á—á–∏–Ω–∞, 1471‚Äì1500 —Ä–æ–∫–∏. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä: –ê—Ä–Ω–æ–ª—å–¥ —Ñ–æ–Ω –í–µ—Å—Ç—Ñ–∞–ª–µ–Ω", 
              archEN: "Albrechtsburg Castle. Meissen, Germany, 1471‚Äì1500. Architect: Arnold von Westfalen",
              chairUA: "–ö—Ä—ñ—Å–ª–æ –∑ —Ä—ñ–∑—å–±–ª–µ–Ω–æ–≥–æ –¥—É–±–∞. –®–æ—Ç–ª–∞–Ω–¥—ñ—è, –±–ª–∏–∑—å–∫–æ 1540 —Ä–æ–∫—É", 
              chairEN: "Carved oak chair. Scotland, circa 1540" },
            
            { id: 2, styleUA: "–†–µ–Ω–µ—Å–∞–Ω—Å", styleEN: "Renaissance", 
              archUA: "–í—ñ–ª–ª–∞ –§–∞—Ä–Ω–µ–∑—ñ–Ω–∞. –†–∏–º, 1506-1510 —Ä–æ–∫–∏. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä: –ë–∞–ª—å–¥–∞—Å—Å–∞—Ä–µ –ü–µ—Ä—É—Ü—Ü—ñ", 
              archEN: "Villa Farnesina. Rome, 1506-1510. Architect: Baldassare Peruzzi",
              chairUA: "–ö—Ä—ñ—Å–ª–æ –∑ —Ä—ñ–∑—å–±–ª–µ–Ω–æ–≥–æ –¥—É–±–∞. –Ü—Ç–∞–ª—ñ—è –±–ª–∏–∑—å–∫–æ 1550 —Ä–æ–∫—É", 
              chairEN: "Carved oak chair. Italy, circa 1550" },
            
            { id: 3, styleUA: "–ë–∞—Ä–æ–∫–æ", styleEN: "Baroque", 
              archUA: "–ó–∞–º–æ–∫ –í–æ-–ª–µ-–í—ñ–∫–æ–Ω—Ç. –ú–µ–ª—å–æ–Ω, –§—Ä–∞–Ω—Ü—ñ—è, 1658-1661 —Ä–æ–∫–∏. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä: –õ—É—ó –õ–µ–≤–æ", 
              archEN: "Ch√¢teau de Vaux-le-Vicomte. Maincy, France, 1658-1661. Architect: Louis Le Vau",
              chairUA: "–ö—Ä—ñ—Å–ª–æ –∑ —Ä—ñ–∑—å–±–ª–µ–Ω–æ–≥–æ –≥–æ—Ä—ñ—Ö–∞ –∑ –æ–∫—Å–∞–º–∏—Ç–æ–≤–æ—é –æ–±–±–∏–≤–∫–æ—é. –í–µ–Ω–µ—Ü—ñ—è, –±–ª–∏–∑—å–∫–æ 1685-1710 —Ä–æ–∫—ñ–≤", 
              chairEN: "Carved walnut armchair with velvet upholstery. Venice, circa 1685-1710" },

            { id: 4, styleUA: "–†–æ–∫–æ–∫–æ", styleEN: "Rococo", 
              archUA: "–ü–∞–≤—ñ–ª—å–π–æ–Ω –ê–º–∞–ª—ñ—î–Ω–±—É—Ä–≥. –ù—ñ–º—Ñ–µ–Ω–±—É—Ä–≥, –ù—ñ–º–µ—á—á–∏–Ω–∞ 1734‚Äì1739 —Ä–æ–∫–∏. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä: –§—Ä–∞–Ω—Å—É–∞ –ö—é–≤—ñ–ª—å—î", 
              archEN: "Amalienburg. Nymphenburg, Germany 1734‚Äì1739. Architect: Fran√ßois de Cuvilli√©s",
              chairUA: "–ö—Ä—ñ—Å–ª–æ –∑ —Ä—ñ–∑—å–±–ª–µ–Ω–æ–≥–æ –±—É–∫–∞ –∑ —à–æ–≤–∫–æ–≤–æ—é –æ–±–±–∏–≤–∫–æ—é. –ü–∞—Ä–∏–∂, –ø–µ—Ä—à–∞ –ø–æ–ª–æ–≤–∏–Ω–∞ XVIII —Å—Ç", 
              chairEN: "Carved beech armchair with silk upholstery. Paris, first half of the 18th century" },

            { id: 5, styleUA: "–ù–µ–æ–∫–ª–∞—Å–∏—Ü–∏–∑–º", styleEN: "Neoclassicism", 
              archUA: "–ö–µ–¥–ª—Å—Ç–æ–Ω-—Ö–æ–ª, –î–µ—Ä–±—ñ—à–∏—Ä, –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω—ñ—è, 1759-1762 —Ä–æ–∫–∏. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä–∏: –î–∂–µ–π–º—Å –ü–µ–π–Ω, –ú–µ—Ç—å—é –ë—Ä–µ—Ç—Ç—ñ–Ω–≥–µ–º, –†–æ–±–µ—Ä—Ç –ê–¥–∞–º", 
              archEN: "Kedleston Hall, Derbyshire, UK, 1759-1762. Architects: James Paine, Matthew Brettingham, Robert Adam",
              chairUA: "–ö—Ä—ñ—Å–ª–æ –∑ —Ä—ñ–∑—å–±–ª–µ–Ω–æ—ó –±–µ—Ä–µ–∑–∏ —ñ–∑ –ø–æ–∑–æ–ª–æ—á–µ–Ω–Ω—è–º —Ç–∞ —à–æ–≤–∫–æ–≤–æ—é –æ–±–±–∏–≤–∫–æ—é. –§—Ä–∞–Ω—Ü—ñ—è –±–ª–∏–∑—å–∫–æ 1780 —Ä–æ–∫—É. –†–æ–±–æ—Ç–∞ –ñ–æ—Ä–∂–∞ –ñ–∞–∫–æ–±–∞", 
              chairEN: "Gilt carved birch armchair with silk upholstery. France c. 1780. By Georges Jacob" },

            { id: 6, styleUA: "–ê–º–ø—ñ—Ä", styleEN: "Empire", 
              archUA: "–¶–µ—Ä–∫–≤–∞ –°–µ–Ω-–ú–∞–¥–ª–µ–Ω, –ü–∞—Ä–∏–∂, –§—Ä–∞–Ω—Ü—ñ—è, 1807-28 —Ä–æ–∫–∏. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä: –ü'—î—Ä-–û–ª–µ–∫—Å–∞–Ω–¥—Ä –í—ñ–Ω—å–æ–Ω", 
              archEN: "La Madeleine, Paris, France, 1807-28. Architect: Pierre-Alexandre Vignon",
              chairUA: "–ö—Ä—ñ—Å–ª–æ –∑ —Ä—ñ–∑—å–±–ª–µ–Ω–æ–≥–æ –≥–æ—Ä—ñ—Ö–∞ —ñ–∑ –ø–æ–∑–æ–ª–æ—á–µ–Ω–Ω—è–º —Ç–∞ –æ–∫—Å–∞–º–∏—Ç–æ–≤–æ—é –æ–±–±–∏–≤–∫–æ—é. –†–∏–º, –±–ª–∏–∑—å–∫–æ 1800-1805 —Ä–æ–∫—ñ–≤", 
              chairEN: "Gilt carved walnut armchair with velvet upholstery. Rome, circa 1800-1805" },

            { id: 7, styleUA: "–ù–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π —Ä–æ–º–∞–Ω—Ç–∏–∑–º", styleEN: "National Romanticism", 
              archUA: "–í—ñ–ª–ª–∞ –ø—ñ–¥ —è–ª–∏–Ω–∞–º–∏. –ó–∞–∫–æ–ø–∞–Ω–µ, –ü–æ–ª—å—â–∞, 1897 —Ä—ñ–∫. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä: –°—Ç–∞–Ω—ñ—Å–ª–∞–≤ –í—ñ—Ç–∫–µ–≤–∏—á", 
              archEN: "Villa Pod Jedlami. Zakopane, Poland, 1897. Architect: Stanis≈Çaw Witkiewicz",
              chairUA: "–°—Ç—ñ–ª–µ—Ü—å —ñ–∑ –∫–æ–ª–µ–∫—Ü—ñ—ó Koti. –§—ñ–Ω–ª—è–Ω–¥—ñ—è, 1903 —Ä—ñ–∫. –î–∏–∑–∞–π–Ω –ï–ª—ñ–µ–ª—è –°–∞–∞—Ä—ñ–Ω–µ–Ω–∞", 
              chairEN: "Chair from the Koti collection. Finland, 1903. Design by Eliel Saarinen" },

            { id: 8, styleUA: "–ê—Ä-–Ω—É–≤–æ", styleEN: "Art Nouveau", 
              archUA: "–í—ñ–ª–ª–∞ –ú–∞–∂–æ—Ä–µ–ª—è. –ù–∞–Ω—Å—ñ, –§—Ä–∞–Ω—Ü—ñ—è, 1901-1902 —Ä–æ–∫–∏. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä: –ê–Ω—Ä—ñ –°–∞–≤–∞–∂", 
              archEN: "Villa Majorelle. Nancy, France, 1901-1902. Architect: Henri Sauvage",
              chairUA: "–ö—Ä—ñ—Å–ª–æ –∑ —Ä—ñ–∑—å–±–ª–µ–Ω–æ–≥–æ –≥–æ—Ä—ñ—Ö–∞ —ñ–∑ —Å–∞—Ç–∏–Ω–æ–≤–æ—é –æ–±–±–∏–≤–∫–æ—é. –ù–∞–Ω—Å—ñ, –§—Ä–∞–Ω—Ü—ñ—è, –±–ª–∏–∑—å–∫–æ 1899-1900 —Ä–æ–∫—ñ–≤. –†–æ–±–æ—Ç–∞ –õ—É—ó –ú–∞–∂–æ—Ä–µ–ª—è", 
              chairEN: "Carved walnut armchair with satin upholstery. Nancy, France, circa 1899-1900. By Louis Majorelle" },

            { id: 9, styleUA: "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∏–π –º–æ–¥–µ—Ä–Ω", styleEN: "Ukrainian Architectural Modern", 
              archUA: "–ë—É–¥–∏–Ω–æ–∫ –ü–æ–ª—Ç–∞–≤—Å—å–∫–æ–≥–æ –≥—É–±–µ—Ä–Ω—Å—å–∫–æ–≥–æ –∑–µ–º—Å—Ç–≤–∞, –ü–æ–ª—Ç–∞–≤–∞, 1903‚Äì1908 —Ä–æ–∫–∏. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä: –í–∞—Å–∏–ª—å –ö—Ä–∏—á–µ–≤—Å—å–∫–∏–π", 
              archEN: "Poltava Governorate Zemstvo building, Poltava, 1903‚Äì1908. Architect: Vasyl Krychevsky",
              chairUA: "–°—Ç—ñ–ª–µ—Ü—å –ü–æ–ª—Ç–∞–≤—Å—å–∫–æ–≥–æ –∫—É—Å—Ç–∞—Ä–Ω–æ–≥–æ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–∞. –ü–æ–ª—Ç–∞–≤–∞, 1910-—Ç—ñ —Ä–æ–∫–∏. –†–æ–±–æ—Ç–∞ –í–æ–ª–æ–¥–∏–º–∏—Ä–∞ –ß–µ—Ä—á–µ–Ω–∫–æ", 
              chairEN: "Chair of Poltava handicraft production. Poltava, circa 1910s. Design by Volodymyr Cherchenko" },

            { id: 10, styleUA: "–ê—Ä-–¥–µ–∫–æ", styleEN: "Art Deco", 
              archUA: "–í—ñ–ª–ª–∞ –ê–º–ø–∞–Ω. –ë—Ä—é—Å—Å–µ–ª—å, 1930‚Äì1934 —Ä–æ–∫–∏. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä: –ú—ñ—à–µ–ª—å –ü–æ–ª–∞–∫", 
              archEN: "Villa Empain. Brussels, 1930‚Äì1934. Architect: Michel Polak",
              chairUA: "–ö—Ä—ñ—Å–ª–æ —ñ–∑ —á–æ—Ä–Ω–æ–≥–æ –¥–µ—Ä–µ–≤–∞. –§—Ä–∞–Ω—Ü—ñ—è, –±–ª–∏–∑—å–∫–æ 1929-1930 —Ä–æ–∫—ñ–≤. –î–∏–∑–∞–π–Ω –ï–º—ñ–ª—è –ñ–∞–∫–∞ –†—É–ª—å–º–∞–Ω–Ω–∞", 
              chairEN: "Ebony armchair. France, circa 1929-1930. Design by √âmile-Jacques Ruhlmann" },

            { id: 11, styleUA: "–†–∞–Ω–Ω—ñ–π –º–æ–¥–µ—Ä–Ω—ñ–∑–º", styleEN: "Early Modernism", 
              archUA: "–í—ñ–ª–ª–∞ –°–∞–≤—É–∞. –ü—É–∞—Å—Å—ñ, –§—Ä–∞–Ω—Ü—ñ—è, 1928-1931 —Ä–æ–∫–∏. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä: –õ–µ –ö–æ—Ä–±—é–∑—å—î", 
              archEN: "Villa Savoye. Poissy, France, 1928-1931. Architect: Le Corbusier",
              chairUA: "–°—Ç—ñ–ª–µ—Ü—å Wassily –∑—ñ —à–∫—ñ—Ä–∏ —Ç–∞ –º–µ—Ç–∞–ª—É. 1925 —Ä—ñ–∫. –î–∏–∑–∞–π–Ω –ú–∞—Ä—Å–µ–ª—è –ë—Ä–æ–π—î—Ä–∞", 
              chairEN: "Wassily chair made of leather and metal. 1925. Design by Marcel Breuer" },

            { id: 12, styleUA: "–ü—ñ–∑–Ω—ñ–π –º–æ–¥–µ—Ä–Ω—ñ–∑–º", styleEN: "Late Modernism", 
              archUA: "–†–µ–∑–∏–¥–µ–Ω—Ü—ñ—è –∫–∞–Ω—Ü–ª–µ—Ä–∞ –§–†–ù. –ë–æ–Ω–Ω, –ù—ñ–º–µ—á—á–∏–Ω–∞, 1963-1966 —Ä–æ–∫–∏. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä: –ó–µ–ø –†—É—Ñ", 
              archEN: "Chancellor's Bungalow. Bonn, Germany, 1963-1966. Architect: Sep Ruf",
              chairUA: "–ö—Ä—ñ—Å–ª–æ GE-240 Cigar –∑ —Ç–∏–∫—É —Ç–∞ –¥—É–±–∞ –∑—ñ –∑–Ω—ñ–º–Ω–∏–º–∏ –ø–æ–¥—É—à–∫–∞–º–∏. –î–∞–Ω—ñ—è, 1950-—Ç—ñ —Ä–æ–∫–∏. –î–∏–∑–∞–π–Ω –•–∞–Ω—Å–∞ –í–µ–≥–Ω–µ—Ä–∞", 
              chairEN: "GE-240 Cigar armchair in teak and oak. Denmark, 1950s. Design by Hans Wegner" },

            { id: 13, styleUA: "–†–µ—Ç—Ä–æ—Ñ—É—Ç—É—Ä–∏–∑–º", styleEN: "Retro-futurism", 
              archUA: "–°–µ—Ä—ñ–π–Ω–∏–π –ø–ª–∞—Å—Ç–∏–∫–æ–≤–∏–π –±—É–¥–∏–Ω–æ–∫ Futuro. –§—ñ–Ω–ª—è–Ω–¥—ñ—è, –ø—Ä–æ—î–∫—Ç 1968 —Ä–æ–∫—É. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä: –ú–∞—Ç—Ç—ñ –°—É—É—Ä–æ–Ω–µ–Ω", 
              archEN: "Futuro plastic house. Finland, 1968 project. Architect: Matti Suuronen",
              chairUA: "–ö—Ä—ñ—Å–ª–æ Ball —ñ–∑ –∞–ª—é–º—ñ–Ω—ñ—é –∑ —Ç–µ–∫—Å—Ç–∏–ª—å–Ω–æ—é –æ–±–±–∏–≤–∫–æ—é. 1973 —Ä—ñ–∫. –î–∏–∑–∞–π–Ω –ï–µ—Ä–æ –ê–∞—Ä–Ω—ñ–æ", 
              chairEN: "Ball Chair made of aluminum with textile upholstery. 1973. Design by Eero Aarnio" },

            { id: 14, styleUA: "–•–∞–π-—Ç–µ–∫", styleEN: "High-tech", 
              archUA: "–ñ–ö ¬´–ê–ª—å–±—ñ–æ–Ω –†—ñ–≤–µ—Ä—Å–∞–π–¥¬ª. –õ–æ–Ω–¥–æ–Ω, –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω—ñ—è, 2003 —Ä—ñ–∫. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä: –ù–æ—Ä–º–∞–Ω –§–æ—Å—Ç–µ—Ä", 
              archEN: "Albion Riverside. London, UK, 2003. Architect: Norman Foster",
              chairUA: "–°—Ç—ñ–ª–µ—Ü—å DS-718 –∑ –º–µ—Ç–∞–ª—É —Ç–∞ —à–∫—ñ—Ä–∏. –®–≤–µ–π—Ü–∞—Ä—ñ—è –î–∏–∑–∞–π–Ω –ö–ª–∞—É–¥—ñ–æ –ë–µ–ª–ª—ñ–Ω—ñ. –í–∏—Ä–æ–±–ª—è—î—Ç—å—Å—è –∫–æ–º–ø–∞–Ω—ñ—î—é De Sede", 
              chairEN: "DS-718 chair made of metal and leather. Switzerland. Design by Claudio Bellini. Produced by De Sede" },

            { id: 15, styleUA: "–ü–æ—Å—Ç–º–æ–¥–µ—Ä–Ω—ñ–∑–º", styleEN: "Postmodernism", 
              archUA: "–í–∏–Ω–æ–≥—Ä–∞–¥–Ω–∏–∫–∏ Clos Pegase. –ö–∞–ª—ñ—Ñ–æ—Ä–Ω—ñ—è, 1984-1987 —Ä–æ–∫–∏. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä: –ú–∞–π–∫–ª –ì—Ä–µ–π–≤—Å", 
              archEN: "Clos Pegase Winery. California, 1984-1987. Architect: Michael Graves",
              chairUA: "–ö—Ä—ñ—Å–ª–æ Proust —ñ–∑ —Ä—ñ–∑—å–±–ª–µ–Ω–æ–≥–æ –¥–µ—Ä–µ–≤–∞ –∑ —Ç–µ–∫—Å—Ç–∏–ª—å–Ω–æ—é –æ–±–±–∏–≤–∫–æ—é. 1978 —Ä—ñ–∫. –î–∏–∑–∞–π–Ω –ê–ª–µ—Å—Å–∞–Ω–¥—Ä–æ –ú–µ–Ω–¥—ñ–Ω—ñ. –í–∏—Ä–æ–±–ª—è—î—Ç—å—Å—è –∫–æ–º–ø–∞–Ω—ñ—î—é Cappellini", 
              chairEN: "Proust armchair made of carved wood with textile upholstery. 1978. Design by Alessandro Mendini. Produced by Cappellini" },

            { id: 16, styleUA: "–î–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤—ñ–∑–º", styleEN: "Deconstructivism", 
              archUA: "¬´–¢–∞–Ω—Ü—é–≤–∞–ª—å–Ω–∏–π –±—É–¥–∏–Ω–æ–∫¬ª. –ü—Ä–∞–≥–∞, 1992-1996 —Ä–æ–∫–∏. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä: –§—Ä–µ–Ω–∫ –ì–µ—Ä—ñ", 
              archEN: "Dancing House. Prague, 1992-1996. Architect: Frank Gehry",
              chairUA: "–°—Ç—ñ–ª–µ—Ü—å Z-chair —ñ–∑ –º–µ—Ç–∞–ª—É. –Ü—Ç–∞–ª—ñ—è, 2011 —Ä—ñ–∫. –î–∏–∑–∞–π–Ω –ó–∞—Ö—ñ –•–∞–¥—ñ–¥. –í–∏—Ä–æ–±–ª—è—î—Ç—å—Å—è –∫–æ–º–ø–∞–Ω—ñ—î—é Sawaya & Moroni", 
              chairEN: "Z-chair made of metal. Italy, 2011. Design by Zaha Hadid. Produced by Sawaya & Moroni" }
        ];

        // --- TRANSLATION & CONFIG ---
        const translations = {
            ua: {
                browserTitle: "–°—Ç–∏–ª—å–Ω–∞ –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∞",
                desc: "–†–∞–Ω—ñ—à–µ, —è–∫—â–æ –≤–∏ –ø–ª—É—Ç–∞–ª–∏ –±–∞—Ä–æ–∫–æ —Ç–∞ –º–æ–¥–µ—Ä–Ω, –¢–∞–Ω—è –æ–¥—Ä–∞–∑—É –≤—Ç—Ä–∞—á–∞–ª–∞ —ñ–Ω—Ç–µ—Ä–µ—Å –¥–æ –≤–∞—Å. –¢–µ–ø–µ—Ä –≤–∏–º–æ–≥–∏ –Ω–µ —Ç–∞–∫—ñ —Å—É–≤–æ—Ä—ñ, –ø—Ä–æ—Ç–µ –∫—Ä–∞—â–µ –Ω–µ —Ä–æ–∑—Å–ª–∞–±–ª—è—Ç–∏—Å—å. –î–ª—è –∫–æ–∂–Ω–æ—ó –±—É–¥—ñ–≤–ª—ñ –ø—ñ–¥–±–µ—Ä—ñ—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Å—Ç—ñ–ª–µ—Ü—å, —è–∫–∏–π –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏–º–µ —ó–π –ø–æ —Å—Ç–∏–ª—é.",
                placeholder: "–í–∫–∞–∂—ñ—Ç—å —Å—Ç–∏–ª—å, —è–∫—â–æ –∑–Ω–∞—î—Ç–µ",
                dropText: "–ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å —Å—Ç—ñ–ª–µ—Ü—å",
                submitBtn: "–ß–∏ –≤–∞—Ä—Ç–∏–π/–∞ —è —É–≤–∞–≥–∏ –¢–∞–Ω—ñ",
                footer: "–ó—Ä–æ–±–ª–µ–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –¥–∞–≤–Ω—å–æ—ó –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∏ –≤—ñ–¥ arzamas",
                retry: "–ü—Ä–æ–π—Ç–∏ —â–µ —Ä–∞–∑",
                resTitle: "–†–µ–∑—É–ª—å—Ç–∞—Ç",
                
                // NEW MODAL STRINGS
                modalTitle: "–ó–∞–ª–∏—à—Ç–µ –≤–∞—à–µ —ñ–º'—è (—â–æ–± –¢–∞–Ω—è –∑–Ω–∞–ª–∞ –ø—Ä–æ –≤–∞—Å)",
                modalPlaceholder: "–í–∞—à–µ —ñ–º'—è...",
                modalBtn: "–î—ñ–∑–Ω–∞—Ç–∏—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç",

                labels: { correct: "–ü—Ä–∞–≤–∏–ª—å–Ω–æ", yourChoice: "–í–∞—à –≤–∏–±—ñ—Ä", yourStyle: "–í–∞—à —Å—Ç–∏–ª—å", style: "–°—Ç–∏–ª—å", arch: "–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞", chair: "–°—Ç—ñ–ª–µ—Ü—å" },
                scores: [
                    { max: 5, text: "–í–∏–±–∞—á—Ç–µ, —É –≤–∞—Å –Ω–µ–º–∞—î –∂–æ–¥–Ω–∏—Ö —à–∞–Ω—Å—ñ–≤ –∑ –¢–∞–Ω–µ—é", emoji: "üíîü•ÄüôÖ‚Äç‚ôÇÔ∏è" },
                    { max: 10, text: "–Ñ –º—ñ–∑–µ—Ä–Ω–∏–π —à–∞–Ω—Å, —â–æ –≤–∏ –∑–∞—Ü—ñ–∫–∞–≤–∏—Ç–µ –¢–∞–Ω—é", emoji: "ü§îüìâü§è" },
                    { max: 14, text: "–©–µ —Ç—Ä–æ—Ö–∏ –ø—ñ–¥—Ç—è–≥–Ω—É—Ç–∏—Å—å —ñ –≤–∏ –≥—ñ–¥–Ω—ñ —É–≤–∞–≥–∏ –¢–µ—Ç—è–Ω–∏", emoji: "üòéüìöüìà" },
                    { max: 16, text: "–¢–∞–Ω—è –≥–æ—Ç–æ–≤–∞ –ø—ñ—Ç–∏ –∑ –≤–∞–º–∏ –Ω–∞ –ø–æ–±–∞—á–µ–Ω–Ω—è", emoji: "üòçüíçü•Ç" }
                ]
            },
            en: {
                browserTitle: "Stylish Puzzle",
                desc: "Previously, if you confused Baroque and Modernism, Tanya would immediately lose interest in you. Now the requirements are not so strict, but better not to relax. For each building, choose the right chair that matches its style.",
                placeholder: "Specify style if you know it",
                dropText: "Drag chair here",
                submitBtn: "Am I worthy of Tanya's attention?",
                footer: "Based on an old puzzle by arzamas",
                retry: "Try again",
                resTitle: "Result",

                // NEW MODAL STRINGS
                modalTitle: "Leave your name (so Tanya knows about you)",
                modalPlaceholder: "Your name...",
                modalBtn: "Show results",

                labels: { correct: "Correct", yourChoice: "Your choice", yourStyle: "Your style", style: "Style", arch: "Architecture", chair: "Chair" },
                scores: [
                    { max: 5, text: "Sorry, you have no chance with Tanya", emoji: "üíîü•ÄüôÖ‚Äç‚ôÇÔ∏è" },
                    { max: 10, text: "There is a tiny chance you might interest Tanya", emoji: "ü§îüìâü§è" },
                    { max: 14, text: "A little more effort and you are worthy of Tanya's attention", emoji: "üòéüìöüìà" },
                    { max: 16, text: "Tanya is ready to go on a date with you", emoji: "üòçüíçü•Ç" }
                ]
            }
        };

        let currentLang = 'ua';
        let shuffledBuildings = []; 

        function setLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            
            document.title = t.browserTitle;
            document.getElementById('page-desc').innerText = t.desc;
            document.documentElement.style.setProperty('--drop-text', `"${t.dropText}"`);
            
            document.querySelectorAll('.style-input').forEach(inp => inp.placeholder = t.placeholder);
            document.getElementById('submit-btn').innerText = t.submitBtn;
            document.getElementById('footer-game').innerText = t.footer;
            
            document.getElementById('retry-btn').innerText = t.retry;
            document.getElementById('retry-btn-bottom').innerText = t.retry;

            // Modal translations
            document.getElementById('modal-title-text').innerText = t.modalTitle;
            document.getElementById('player-name').placeholder = t.modalPlaceholder;
            document.getElementById('modal-btn').innerText = t.modalBtn;

            document.getElementById('btn-ua').classList.toggle('active', lang === 'ua');
            document.getElementById('btn-en').classList.toggle('active', lang === 'en');
        }

        // --- GAME LOGIC ---
        function initGame() {
            const container = document.getElementById('buildings-container');
            const submitContainer = document.getElementById('submit-container');
            const pool = document.getElementById('chairs-pool');
            
            Array.from(container.children).forEach(child => {
                if(child.id !== 'submit-container' && child.id !== 'footer-game') container.removeChild(child);
            });
            pool.innerHTML = '';

            let indices = Array.from({length: 16}, (_, i) => i + 1);
            shuffledBuildings = [...indices]; 
            shuffleArray(shuffledBuildings);
            let shuffledChairs = [...indices];
            shuffleArray(shuffledChairs);

            // Buildings
            shuffledBuildings.forEach(id => {
                const card = document.createElement('div');
                card.className = 'card';
                
                const img = document.createElement('img');
                img.src = `a${id}.jpg`;
                img.className = 'building-img';
                
                const zone = document.createElement('div');
                zone.className = 'chair-drop-zone';
                zone.id = `zone-A${id}`; 
                zone.ondrop = (e) => drop(e, zone);
                zone.ondragover = allowDrop;

                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'style-input';
                input.id = `input-A${id}`;
                input.placeholder = translations[currentLang].placeholder;

                card.appendChild(img);
                card.appendChild(zone);
                card.appendChild(input);
                
                container.insertBefore(card, submitContainer);
            });

            // Chairs
            shuffledChairs.forEach(id => {
                const img = document.createElement('img');
                img.src = `c${id}.png`;
                img.id = `C${id}`;
                img.className = 'chair-item';
                img.draggable = true;
                img.ondragstart = drag;
                img.addEventListener('touchstart', handleTouchStart, {passive: false});
                img.addEventListener('touchmove', handleTouchMove, {passive: false});
                img.addEventListener('touchend', handleTouchEnd);
                
                pool.appendChild(img);
            });
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // --- NEW FLOW: 1. OPEN MODAL ---
        function openNameModal() {
            const modal = document.getElementById('modal-overlay');
            modal.style.display = 'flex';
            
            const input = document.getElementById('player-name');
            input.value = ''; // Clean input
            checkNameInput(); // Reset button state
            
            input.focus();
        }

        // Check if name input is valid
        function checkNameInput() {
            const name = document.getElementById('player-name').value.trim();
            const btn = document.getElementById('modal-btn');
            
            if (name.length > 0) {
                btn.disabled = false;
            } else {
                btn.disabled = true;
            }
        }

        // --- NEW FLOW: 2. FINISH AND CALCULATE ---
        function finishGame() {
            // Close modal
            document.getElementById('modal-overlay').style.display = 'none';
            
            // Get Name
            let playerName = document.getElementById('player-name').value.trim();
            if(!playerName) playerName = "Anonymous";

            let score = 0;
            const resultsList = document.getElementById('results-list');
            resultsList.innerHTML = '';
            const t = translations[currentLang];

            for (let i = 1; i <= 16; i++) {
                const zone = document.getElementById(`zone-A${i}`);
                const input = document.getElementById(`input-A${i}`);
                const db = gameDB.find(item => item.id === i);

                let userChairSrc = null;
                let isCorrect = false;

                if (zone.children.length > 0) {
                    const chairId = zone.children[0].id; 
                    userChairSrc = zone.children[0].src;
                    
                    if (chairId === `C${i}`) {
                        isCorrect = true;
                        score++;
                    }
                }

                const itemDiv = document.createElement('div');
                itemDiv.className = `result-item ${isCorrect ? 'correct' : 'incorrect'}`;

                const styleName = currentLang === 'ua' ? db.styleUA : db.styleEN;
                const archDesc = currentLang === 'ua' ? db.archUA : db.archEN;
                const chairDesc = currentLang === 'ua' ? db.chairUA : db.chairEN;
                const userText = input.value.trim() || "‚Äî";

                itemDiv.innerHTML = `
                    <div class="result-header">${styleName}</div>
                    <div class="result-grid">
                        <div class="res-img-block">
                            <img src="a${i}.jpg" class="res-img b-img">
                            </div>
                        <div class="res-img-block">
                            <img src="c${i}.png" class="res-img">
                            <div>${t.labels.correct}</div>
                        </div>
                        <div class="res-img-block">
                            <div style="width:auto; height:240px; display:flex; align-items:center; justify-content:center; margin: 0 auto 8px auto;">
                                ${userChairSrc ? `<img src="${userChairSrc}" class="res-img">` : `<span style="color:#D1D5DB; font-size:24px; border:1px dashed #D1D5DB; border-radius:6px; width:80px; height:80px; display:flex; align-items:center; justify-content:center;">?</span>`}
                            </div>
                            <div>${t.labels.yourChoice}</div>
                        </div>
                    </div>
                    <div class="user-input-display">${t.labels.yourStyle}: <b>${userText}</b></div>
                    <div class="result-details">
                        <b>${t.labels.style}:</b> ${styleName}<br>
                        <b>${t.labels.arch}:</b> ${archDesc}<br>
                        <b>${t.labels.chair}:</b> ${chairDesc}
                    </div>
                `;
                resultsList.appendChild(itemDiv);
            }

            let finalMsg = "";
            let finalEmoji = "";
            for (let s of t.scores) {
                if (score <= s.max) {
                    finalMsg = s.text;
                    finalEmoji = s.emoji;
                    break;
                }
            }

            // --- GOOGLE ANALYTICS EVENT ---
            if (typeof gtag === 'function') {
                gtag('event', 'puzzle_finished', {
                    'score': score,
                    'max_score': 16,
                    'result_message': finalMsg,
                    'language': currentLang,
                    'player_name': playerName // Added name here
                });
            }

            // --- TELEGRAM NOTIFICATION ---
            sendTelegramMessage(playerName, score, currentLang);

            document.getElementById('score-val').innerText = `${score} / 16`;
            document.getElementById('score-msg').innerText = finalMsg;
            document.getElementById('score-emojis').innerText = finalEmoji;
            
            document.getElementById('score-val-bottom').innerText = `${score} / 16`;
            document.getElementById('score-msg-bottom').innerText = finalMsg;
            document.getElementById('score-emojis-bottom').innerText = finalEmoji;
            
            document.getElementById('game-view').style.display = 'none';
            document.getElementById('results-view').style.display = 'flex';
            
            window.scrollTo(0,0);
        }

        function sendTelegramMessage(name, score, lang) {
            // –í–∞—à—ñ –¥–∞–Ω—ñ
            const token = "8081479228:AAFU5isIMyKGlRW2aa44rGiLrksUKo41MWk";
            const chatId = "359478904";

            // –§–æ—Ä–º—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
            const text = `üé® *–•—Ç–æ—Å—å –ø—Ä–æ–π—à–æ–≤ –°—Ç–∏–ª—å–Ω—É –ì–æ–ª–æ–≤–æ–ª–æ–º–∫—É!*%0A%0Aüë§ –Ü–º'—è: *${name}*%0AüèÜ –†–∞—Ö—É–Ω–æ–∫: *${score} / 16*%0Aüåç –ú–æ–≤–∞: ${lang}`;
            
            // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∑–∞–ø–∏—Ç
            const url = `https://api.telegram.org/bot${token}/sendMessage?chat_id=${chatId}&text=${text}&parse_mode=Markdown`;

            fetch(url).catch(err => console.error("Telegram send error:", err));
        }

        function resetGame() {
            document.getElementById('results-view').style.display = 'none';
            document.getElementById('game-view').style.display = 'flex';
            document.getElementById('player-name').value = ''; // Clean name input
            initGame();
        }

        // --- DRAG & DROP LOGIC ---
        function allowDrop(ev) {
            ev.preventDefault();
            if (ev.target.classList.contains('chair-drop-zone')) ev.target.classList.add('drag-over');
        }
        document.addEventListener('dragleave', (ev) => {
            if (ev.target.classList.contains('chair-drop-zone')) ev.target.classList.remove('drag-over');
        });
        function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }
        function drop(ev, zone) {
            ev.preventDefault();
            zone.classList.remove('drag-over');
            var data = ev.dataTransfer.getData("text");
            var draggedElement = document.getElementById(data);
            if (!draggedElement) return;
            placeItemInZone(draggedElement, zone);
        }
        function dropToPool(ev) {
            ev.preventDefault();
            var data = ev.dataTransfer.getData("text");
            var draggedElement = document.getElementById(data);
            if (draggedElement) returnToPool(draggedElement);
        }

        // --- MOBILE TOUCH LOGIC ---
        let touchDragItem = null;
        let originalParent = null;
        let startX = 0, startY = 0;

        function handleTouchStart(e) {
            touchDragItem = e.target;
            originalParent = touchDragItem.parentElement;
            const t = e.touches[0];
            startX = t.clientX; startY = t.clientY;
        }

        function handleTouchMove(e) {
            if (!touchDragItem) return;
            const t = e.touches[0];
            const dx = Math.abs(t.clientX - startX);
            const dy = Math.abs(t.clientY - startY);

            if (!touchDragItem.classList.contains('dragging-mobile')) {
                if (originalParent.id === 'chairs-pool' && dx > dy) return;
                if (dy > 5) {
                    touchDragItem.classList.add('dragging-mobile');
                    document.body.appendChild(touchDragItem);
                }
            }
            if (touchDragItem.classList.contains('dragging-mobile')) {
                e.preventDefault();
                touchDragItem.style.left = t.clientX + 'px';
                touchDragItem.style.top = t.clientY + 'px';
            }
        }

        function handleTouchEnd(e) {
            if (!touchDragItem) return;
            if (!touchDragItem.classList.contains('dragging-mobile')) { touchDragItem = null; return; }

            const t = e.changedTouches[0];
            touchDragItem.style.display = 'none';
            let el = document.elementFromPoint(t.clientX, t.clientY);
            touchDragItem.style.display = 'block';

            let dropZone = el ? el.closest('.chair-drop-zone') : null;
            let poolZone = el ? el.closest('#chairs-pool') : null;

            touchDragItem.classList.remove('dragging-mobile');
            Object.assign(touchDragItem.style, {left:'', top:'', position:'', zIndex:'', width:'', height:'', background:'', border:'', borderRadius:''});

            if (dropZone) placeItemInZone(touchDragItem, dropZone);
            else if (poolZone) returnToPool(touchDragItem);
            else if (originalParent && originalParent.classList.contains('chair-drop-zone')) placeItemInZone(touchDragItem, originalParent);
            else returnToPool(touchDragItem);
            
            touchDragItem = null;
        }

        function placeItemInZone(item, zone) {
            if (zone.children.length > 0 && zone.children[0] !== item) returnToPool(zone.children[0]);
            if (item.parentElement.classList.contains('chair-drop-zone')) item.parentElement.classList.remove('has-item');
            zone.appendChild(item);
            zone.classList.add('has-item');
        }

        function returnToPool(item) {
            if (item.parentElement.classList.contains('chair-drop-zone')) item.parentElement.classList.remove('has-item');
            document.getElementById('chairs-pool').appendChild(item);
        }

        // --- START ---
        initGame();
        setLanguage('ua'); 
    </script>
</body>
</html>
