<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Стильна головоломка</title>
    <style>
        :root {
            --drop-text: "Перетягніть стілець";
            
            /* --- НОВА КОЛЬОРОВА ГАМА (Gallery Theme) --- */
            --bg-color: #F7F7F5; /* Теплий світло-сірий (камінь) */
            --card-bg: #FFFFFF;
            --text-main: #37474F; /* Глибокий грифельний */
            --text-secondary: #78909C; /* М'який сіро-блакитний */
            
            --accent-color: #546E7A; /* Стриманий синьо-сірий для акцентів */
            --btn-gradient: linear-gradient(135deg, #455A64 0%, #263238 100%);
            
            --success-color: #66BB6A; /* Приглушений зелений */
            --error-color: #EF5350;   /* Приглушений червоний */
            
            --panel-bg: #263238;      /* Темний фон для панелі стільців */
            
            --shadow-soft: 0 4px 20px rgba(0,0,0,0.03);
            --shadow-card: 0 1px 3px rgba(0,0,0,0.05);
            --radius-main: 12px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow-x: hidden;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            -webkit-font-smoothing: antialiased;
        }

        /* --- HEADER --- */
        /* ПРАВКА: position: relative, щоб він скролився разом зі сторінкою */
        #header {
            display: flex;
            flex-direction: column;
            padding: 20px 24px;
            background: var(--bg-color); /* Фон як у сторінки, щоб менше виділявся */
            z-index: 500;
            flex-shrink: 0;
            position: relative; 
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        
        .header-top {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            width: 100%;
        }
        
        .header-desc {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 10px;
            line-height: 1.5;
            max-width: 800px;
            font-weight: 400;
        }

        .lang-switch { 
            font-size: 13px; 
            font-weight: 600; 
            cursor: pointer; 
            color: #B0BEC5; 
            letter-spacing: 0.5px;
            transition: color 0.2s;
            pointer-events: auto; 
        }
        .lang-switch:hover { color: var(--text-main); }
        .lang-switch.active { color: var(--text-main); text-decoration: none; border-bottom: 2px solid var(--text-main); padding-bottom: 2px;}
        .lang-separator { margin: 0 10px; color: #CFD8DC; }

        /* --- VIEWS --- */
        #game-view { display: flex; flex-direction: column; height: 100%; }
        #results-view { display: none; flex-direction: column; height: 100%; overflow-y: auto; padding: 24px; padding-bottom: 100px; }

        /* --- GAME GRID --- */
        #buildings-container {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            display: grid;
            padding: 24px;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px; /* Більший простір між картками */
            padding-bottom: 200px; /* Місце під тонку панель */
        }

        .card {
            background: var(--card-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            border-radius: var(--radius-main);
            box-shadow: var(--shadow-card);
            padding: 20px;
            border: 1px solid rgba(0,0,0,0.02);
        }

        .building-img {
            width: 100%;
            aspect-ratio: 16 / 10;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 16px;
            pointer-events: none;
            -webkit-user-drag: none;
            background-color: #ECEFF1;
            filter: brightness(0.98); /* Трохи приглушуємо яскравість фото для стилю */
        }

        .chair-drop-zone {
            height: 180px;
            border: 1px dashed #B0BEC5; /* Тонша, делікатна рамка */
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #FAFAFA;
            margin-bottom: 16px;
            position: relative;
            width: 100%;
            transition: all 0.3s ease;
        }
        .chair-drop-zone:not(.has-item)::after {
            content: var(--drop-text);
            position: absolute;
            color: #CFD8DC;
            font-size: 13px;
            pointer-events: none;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .chair-drop-zone.drag-over { 
            background-color: rgba(84, 110, 122, 0.05); 
            border-color: var(--accent-color); 
        }
        .chair-drop-zone.has-item { 
            border-style: solid; 
            border-color: transparent; 
            background-color: #fff; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .style-input {
            padding: 12px;
            border: 1px solid #CFD8DC;
            border-radius: 6px;
            font-size: 15px;
            width: 100%;
            text-align: center;
            background: #fff;
            color: var(--text-main);
            -webkit-user-select: text;
            user-select: text;
            transition: all 0.2s;
            outline: none;
        }
        .style-input:focus {
            border-color: var(--accent-color);
            background: #fff;
        }

        /* --- SUBMIT BUTTON --- */
        #submit-container {
            grid-column: 1 / -1;
            display: flex;
            justify-content: center;
            margin-top: 40px;
            margin-bottom: 20px;
        }
        .action-btn {
            background: var(--btn-gradient);
            color: white;
            border: none;
            padding: 14px 32px;
            font-size: 15px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(55, 71, 79, 0.2);
            transition: transform 0.2s, box-shadow 0.2s;
            pointer-events: auto;
            text-align: center;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        .action-btn:hover { 
            transform: translateY(-1px); 
            box-shadow: 0 6px 20px rgba(55, 71, 79, 0.3); 
        }
        .action-btn:active { transform: scale(0.98); }

        #footer-game {
            grid-column: 1 / -1;
            text-align: right;
            color: #B0BEC5;
            font-size: 11px;
            margin-top: 10px;
            padding-right: 10px;
            font-weight: 500;
        }

        /* --- POOL (Compact Modern Drawer) --- */
        #chairs-pool {
            position: fixed;
            bottom: 0; left: 0; width: 100%; 
            /* ПРАВКА: Значно менша висота */
            height: 160px; 
            background-color: var(--panel-bg);
            /* ПРАВКА: Мінімальні відступи */
            padding-top: 15px; 
            padding-bottom: 10px;
            display: flex; align-items: flex-start;
            overflow-x: auto; z-index: 1000;
            
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            /* Тонкий скрол */
            scrollbar-width: thin;
            scrollbar-color: #546E7A var(--panel-bg);
        }
        
        /* Ручка для краси */
        #chairs-pool::before {
            content: "";
            position: fixed;
            bottom: 150px; /* Підлаштовано під висоту */
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background-color: rgba(255,255,255,0.1);
            border-radius: 3px;
            pointer-events: none;
        }

        .chair-item {
            /* ПРАВКА: Менші розміри стільців у стрічці */
            min-width: 100px; width: 100px; height: 100px;
            margin: 5px 8px; 
            cursor: grab; 
            background: #fff; 
            border-radius: 8px; 
            padding: 5px;
            object-fit: contain; 
            box-sizing: border-box; 
            pointer-events: auto;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .chair-item:active { cursor: grabbing; transform: scale(0.95); }
        
        .chair-item.dragging-mobile {
            position: fixed; z-index: 9999; opacity: 0.95; pointer-events: none;
            width: 110px; height: 110px; border-radius: 50%; 
            border: 2px solid var(--accent-color);
            background: #fff; 
            transform: translate(-50%, -50%); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        /* --- RESULTS STYLES --- */
        .score-card {
            background: #fff; padding: 32px; border-radius: 16px;
            text-align: center; margin-bottom: 30px;
            box-shadow: var(--shadow-soft);
            border-top: 4px solid var(--accent-color);
        }
        .score-title { font-size: 36px; font-weight: 800; color: var(--text-main); margin-bottom: 8px; letter-spacing: -0.5px; }
        .score-text { font-size: 16px; color: var(--text-secondary); line-height: 1.5; margin-bottom: 24px; }

        .result-item {
            background: #fff; border-radius: 12px; padding: 20px; margin-bottom: 24px;
            box-shadow: var(--shadow-card);
            border-left: 4px solid transparent;
        }
        .result-item.correct { border-left-color: var(--success-color); }
        .result-item.incorrect { border-left-color: var(--error-color); }
        
        .result-header { font-size: 18px; font-weight: 700; margin-bottom: 16px; color: var(--text-main); }
        
        .result-grid {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 16px;
            align-items: end;
        }
        .res-img-block { text-align: center; font-size: 10px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 700;}
        .res-img-block div:last-child { margin-top: 6px; }

        .res-img { 
            width: auto; height: 160px; max-width: 100%;
            object-fit: contain; background: #fff; border-radius: 4px; 
            border: 1px solid #ECEFF1; padding: 4px; display: block; margin: 0 auto;
        }
        .b-img { width: 100%; height: auto; aspect-ratio: 16/10; object-fit: cover; border: none; padding: 0; }
        
        .result-details { font-size: 14px; line-height: 1.6; color: var(--text-main); border-top: 1px solid #ECEFF1; padding-top: 12px;}
        .result-details b { color: var(--accent-color); font-weight: 600; }
        .user-input-display { font-style: italic; color: var(--text-secondary); margin-bottom: 8px; font-size: 13px;}

        /* --- MOBILE ADAPTATION --- */
        @media (max-width: 600px) {
            #buildings-container { 
                padding: 0; 
                gap: 0; 
                display: block; 
                padding-bottom: 150px !important; /* Підлаштовано під нову висоту панелі */
            }
            
            .card { 
                border-radius: 0; 
                border: none;
                box-shadow: none; 
                margin-bottom: 0; 
                width: 100%; 
                /* ПРАВКА: Більше повітря і простору всередині картки */
                padding: 30px 20px 40px 20px; 
                background: #fff;
            }
            /* ПРАВКА: Помітний розділювач між блоками */
            .card + .card { 
                border-top: 12px solid #ECEFF1; 
            }
            
            .building-img { border-radius: 0; margin-bottom: 24px; width: 100%; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
            .chair-drop-zone, .style-input { width: 100%; margin: 0 auto 16px auto; }
            
            .result-grid { grid-template-columns: 1fr; gap: 20px; }
            .res-img { height: 160px; } 
            .b-img { width: 100%; aspect-ratio: 16/10; height: auto;}
            
            #footer-game { text-align: center; padding-right: 0; margin-bottom: 20px; margin-top: 20px;} 
            
            #header { padding: 15px 20px; }
            .header-desc { font-size: 13px; }

            /* ПРАВКА: Супер тонка панель на мобільному */
            #chairs-pool {
                height: 130px; /* Дуже компактно */
                padding-top: 10px;
                padding-bottom: 5px;
            }
            #chairs-pool::before { display: none; } /* Прибираємо ручку на мобільному для економії місця */
            
            .chair-item {
                min-width: 90px; width: 90px; height: 90px; /* Менші картинки */
                margin: 5px;
            }
        }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="header">
        <div class="header-top">
            <div>
                <span class="lang-switch active" id="btn-ua" onclick="setLanguage('ua')">UA</span>
                <span class="lang-separator">|</span>
                <span class="lang-switch" id="btn-en" onclick="setLanguage('en')">EN</span>
            </div>
        </div>
        <div class="header-desc" id="page-desc">
            Раніше, якщо ви плутали бароко та модерн, Таня одразу втрачала інтерес до вас. Тепер вимоги не такі сурові, проте краще не розслаблятись.
        </div>
    </div>

    <div id="game-view">
        <div id="buildings-container">
            <div id="submit-container">
                <button class="action-btn" onclick="checkResults()" id="submit-btn">Чи вартий/а я уваги Тані</button>
            </div>
            <div id="footer-game">Зроблено на основі давньої головоломки від arzamas</div>
        </div>
        <div id="chairs-pool" ondrop="dropToPool(event)" ondragover="allowDrop(event)">
            </div>
    </div>

    <div id="results-view">
        <div class="score-card">
            <div class="score-title" id="score-val">0 / 16</div>
            <div class="score-text" id="score-msg">...</div>
            <button class="action-btn" onclick="resetGame()" id="retry-btn">Пройти ще раз</button>
        </div>
        <div id="results-list">
            </div>
    </div>

    <script>
        // --- DATASET ---
        const gameDB = [
            { id: 1, styleUA: "Готика", styleEN: "Gothic", 
              archUA: "Замок Альбрехтсбург. Майсен, Німеччина, 1471–1500 роки. Архітектор: Арнольд фон Вестфален", 
              archEN: "Albrechtsburg Castle. Meissen, Germany, 1471–1500. Architect: Arnold von Westfalen",
              chairUA: "Крісло з різьбленого дуба. Шотландія, близько 1540 року", 
              chairEN: "Carved oak chair. Scotland, circa 1540" },
            
            { id: 2, styleUA: "Ренесанс", styleEN: "Renaissance", 
              archUA: "Вілла Фарнезіна. Рим, 1506-1510 роки. Архітектор: Бальдассаре Перуцці", 
              archEN: "Villa Farnesina. Rome, 1506-1510. Architect: Baldassare Peruzzi",
              chairUA: "Крісло з різьбленого дуба. Італія близько 1550 року", 
              chairEN: "Carved oak chair. Italy, circa 1550" },
            
            { id: 3, styleUA: "Бароко", styleEN: "Baroque", 
              archUA: "Замок Во-ле-Віконт. Мельон, Франція, 1658-1661 роки. Архітектор: Луї Лево", 
              archEN: "Château de Vaux-le-Vicomte. Maincy, France, 1658-1661. Architect: Louis Le Vau",
              chairUA: "Крісло з різьбленого горіха з оксамитовою оббивкою. Венеція, близько 1685-1710 років", 
              chairEN: "Carved walnut armchair with velvet upholstery. Venice, circa 1685-1710" },

            { id: 4, styleUA: "Рококо", styleEN: "Rococo", 
              archUA: "Павільйон Амалієнбург. Німфенбург, Німеччина 1734–1739 роки. Архітектор: Франсуа Кювільє", 
              archEN: "Amalienburg. Nymphenburg, Germany 1734–1739. Architect: François de Cuvilliés",
              chairUA: "Крісло з різьбленого бука з шовковою оббивкою. Париж, перша половина XVIII ст", 
              chairEN: "Carved beech armchair with silk upholstery. Paris, first half of the 18th century" },

            { id: 5, styleUA: "Неокласицизм", styleEN: "Neoclassicism", 
              archUA: "Кедлстон-хол, Дербішир, Великобританія, 1759-1762 роки. Архітектори: Джеймс Пейн, Метью Бреттінгем, Роберт Адам", 
              archEN: "Kedleston Hall, Derbyshire, UK, 1759-1762. Architects: James Paine, Matthew Brettingham, Robert Adam",
              chairUA: "Крісло з різьбленої берези із позолоченням та шовковою оббивкою. Франція близько 1780 року. Робота Жоржа Жакоба", 
              chairEN: "Gilt carved birch armchair with silk upholstery. France c. 1780. By Georges Jacob" },

            { id: 6, styleUA: "Ампір", styleEN: "Empire", 
              archUA: "Церква Сен-Мадлен, Париж, Франція, 1807-28 роки. Архітектор: П'єр-Олександр Віньон", 
              archEN: "La Madeleine, Paris, France, 1807-28. Architect: Pierre-Alexandre Vignon",
              chairUA: "Крісло з різьбленого горіха із позолоченням та оксамитовою оббивкою. Рим, близько 1800-1805 років", 
              chairEN: "Gilt carved walnut armchair with velvet upholstery. Rome, circa 1800-1805" },

            { id: 7, styleUA: "Національний романтизм", styleEN: "National Romanticism", 
              archUA: "Вілла під ялинами. Закопане, Польща, 1897 рік. Архітектор: Станіслав Віткевич", 
              archEN: "Villa Pod Jedlami (Villa under the Firs). Zakopane, Poland, 1897. Architect: Stanisław Witkiewicz",
              chairUA: "Стілець із колекції Koti. Фінляндія, 1903 рік. Дизайн Еліеля Саарінена", 
              chairEN: "Chair from the Koti collection. Finland, 1903. Design by Eliel Saarinen" },

            { id: 8, styleUA: "Ар-нуво", styleEN: "Art Nouveau", 
              archUA: "Вілла Мажореля. Нансі, Франція, 1901-1902 роки. Архітектор: Анрі Саваж", 
              archEN: "Villa Majorelle. Nancy, France, 1901-1902. Architect: Henri Sauvage",
              chairUA: "Крісло з різьбленого горіха із сатиновою оббивкою. Нансі, Франція, близько 1899-1900 років. Робота Луї Мажореля", 
              chairEN: "Carved walnut armchair with satin upholstery. Nancy, France, circa 1899-1900. By Louis Majorelle" },

            { id: 9, styleUA: "Український архітектурний модерн", styleEN: "Ukrainian Architectural Modern", 
              archUA: "Будинок Полтавського губернського земства, Полтава, 1903–1908 роки. Архітектор: Василь Кричевський", 
              archEN: "Poltava Governorate Zemstvo building, Poltava, 1903–1908. Architect: Vasyl Krychevsky",
              chairUA: "Стілець Полтавського кустарного виробництва. Полтава, близько 1910-ті роки. Дизайн Володимира Черченко", 
              chairEN: "Chair of Poltava handicraft production. Poltava, circa 1910s. Design by Volodymyr Cherchenko" },

            { id: 10, styleUA: "Ар-деко", styleEN: "Art Deco", 
              archUA: "Вілла Ампан. Брюссель, 1930–1934 роки. Архітектор: Мішель Полак", 
              archEN: "Villa Empain. Brussels, 1930–1934. Architect: Michel Polak",
              chairUA: "Крісло із чорного дерева. Франція, близько 1929-1930 років. Дизайн Еміля Жака Рульманна", 
              chairEN: "Ebony armchair. France, circa 1929-1930. Design by Émile-Jacques Ruhlmann" },

            { id: 11, styleUA: "Ранній модернізм", styleEN: "Early Modernism", 
              archUA: "Вілла Савуа. Пуассі, Франція, 1928-1931 роки. Архітектор: Ле Корбюзьє", 
              archEN: "Villa Savoye. Poissy, France, 1928-1931. Architect: Le Corbusier",
              chairUA: "Стілець Wassily зі шкіри та металу. 1925 рік. Дизайн Марселя Бройєра", 
              chairEN: "Wassily chair made of leather and metal. 1925. Design by Marcel Breuer" },

            { id: 12, styleUA: "Пізній модернізм", styleEN: "Late Modernism", 
              archUA: "Резиденція канцлера ФРН. Бонн, Німеччина, 1963-1966 роки. Архітектор: Зеп Руф", 
              archEN: "Chancellor's Bungalow. Bonn, Germany, 1963-1966. Architect: Sep Ruf",
              chairUA: "Крісло GE-240 Cigar з тику та дуба зі знімними подушками. Данія, 1950-ті роки. Дизайн Ханса Вегнера", 
              chairEN: "GE-240 Cigar armchair in teak and oak. Denmark, 1950s. Design by Hans Wegner" },

            { id: 13, styleUA: "Ретрофутуризм", styleEN: "Retro-futurism", 
              archUA: "Серійний пластиковий будинок Futuro. Фінляндія, проєкт 1968 року. Архітектор: Матті Сууронен", 
              archEN: "Futuro plastic house. Finland, 1968 project. Architect: Matti Suuronen",
              chairUA: "Крісло Ball із алюмінію з текстильною оббивкою. 1973 рік. Дизайн Ееро Аарніо", 
              chairEN: "Ball Chair made of aluminum with textile upholstery. 1973. Design by Eero Aarnio" },

            { id: 14, styleUA: "Хай-тек", styleEN: "High-tech", 
              archUA: "ЖК «Альбіон Ріверсайд». Лондон, Великобританія, 2003 рік. Архітектор: Норман Фостер", 
              archEN: "Albion Riverside. London, UK, 2003. Architect: Norman Foster",
              chairUA: "Стілець DS-718 з металу та шкіри. Швейцарія Дизайн Клаудіо Белліні. Виробляється компанією De Sede", 
              chairEN: "DS-718 chair made of metal and leather. Switzerland. Design by Claudio Bellini. Produced by De Sede" },

            { id: 15, styleUA: "Постмодернізм", styleEN: "Postmodernism", 
              archUA: "Виноградники Clos Pegase. Каліфорнія, 1984-1987 роки. Архітектор: Майкл Грейвс", 
              archEN: "Clos Pegase Winery. California, 1984-1987. Architect: Michael Graves",
              chairUA: "Крісло Proust із різьбленого дерева з текстильною оббивкою. 1978 рік. Дизайн Алессандро Мендіні. Виробляється компанією Cappellini", 
              chairEN: "Proust armchair made of carved wood with textile upholstery. 1978. Design by Alessandro Mendini. Produced by Cappellini" },

            { id: 16, styleUA: "Деконструктивізм", styleEN: "Deconstructivism", 
              archUA: "«Танцювальний будинок». Прага, 1992-1996 роки. Архітектор: Френк Гері", 
              archEN: "Dancing House. Prague, 1992-1996. Architect: Frank Gehry",
              chairUA: "Стілець Z-chair із металу. Італія, 2011 рік. Дизайн Захі Хадід. Виробляється компанією Sawaya & Moroni", 
              chairEN: "Z-chair made of metal. Italy, 2011. Design by Zaha Hadid. Produced by Sawaya & Moroni" }
        ];

        // --- TRANSLATION CONFIG ---
        const translations = {
            ua: {
                browserTitle: "Стильна головоломка",
                desc: "Раніше, якщо ви плутали бароко та модерн, Таня одразу втрачала інтерес до вас. Тепер вимоги не такі сурові, проте краще не розслаблятись.",
                placeholder: "Вкажіть стиль",
                dropText: "Перетягніть стілець",
                submitBtn: "Чи вартий/а я уваги Тані",
                footer: "Зроблено на основі давньої головоломки від arzamas",
                retry: "Пройти ще раз",
                resTitle: "Результат",
                labels: { correct: "Правильно", yourChoice: "Ваш вибір", yourStyle: "Ваш стиль", style: "Стиль", arch: "Архітектура", chair: "Стілець" },
                scores: [
                    { max: 5, text: "Вибачте, у вас немає жодних шансів з Танею" },
                    { max: 10, text: "Є мізерний шанс, що ви зацікавите Таню" },
                    { max: 14, text: "Ще трохи підтягнутись і ви гідні уваги Тетяни" },
                    { max: 16, text: "Таня готова піти з вами на побачення" }
                ]
            },
            en: {
                browserTitle: "Stylish Puzzle",
                desc: "Previously, if you confused Baroque and Modernism, Tanya would immediately lose interest in you. Now the requirements are not so strict, but better not to relax.",
                placeholder: "Specify style",
                dropText: "Drag chair here",
                submitBtn: "Am I worthy of Tanya's attention?",
                footer: "Based on an old puzzle by arzamas",
                retry: "Try again",
                resTitle: "Result",
                labels: { correct: "Correct", yourChoice: "Your choice", yourStyle: "Your style", style: "Style", arch: "Architecture", chair: "Chair" },
                scores: [
                    { max: 5, text: "Sorry, you have no chance with Tanya" },
                    { max: 10, text: "There is a tiny chance you might interest Tanya" },
                    { max: 14, text: "A little more effort and you are worthy of Tanya's attention" },
                    { max: 16, text: "Tanya is ready to go on a date with you" }
                ]
            }
        };

        let currentLang = 'ua';
        let shuffledBuildings = []; 

        // --- INIT & LANGUAGE ---
        function setLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            
            document.title = t.browserTitle;
            document.getElementById('page-desc').innerText = t.desc;
            document.documentElement.style.setProperty('--drop-text', `"${t.dropText}"`);
            
            document.querySelectorAll('.style-input').forEach(inp => inp.placeholder = t.placeholder);
            document.getElementById('submit-btn').innerText = t.submitBtn;
            document.getElementById('footer-game').innerText = t.footer;
            document.getElementById('retry-btn').innerText = t.retry;

            document.getElementById('btn-ua').classList.toggle('active', lang === 'ua');
            document.getElementById('btn-en').classList.toggle('active', lang === 'en');
        }

        // --- GAME GENERATION ---
        function initGame() {
            const container = document.getElementById('buildings-container');
            const submitContainer = document.getElementById('submit-container');
            const pool = document.getElementById('chairs-pool');
            
            Array.from(container.children).forEach(child => {
                if(child.id !== 'submit-container' && child.id !== 'footer-game') container.removeChild(child);
            });
            pool.innerHTML = '';

            let indices = Array.from({length: 16}, (_, i) => i + 1);
            
            shuffledBuildings = [...indices]; 
            shuffleArray(shuffledBuildings);
            
            let shuffledChairs = [...indices];
            shuffleArray(shuffledChairs);

            // Buildings
            shuffledBuildings.forEach(id => {
                const card = document.createElement('div');
                card.className = 'card';
                
                const img = document.createElement('img');
                img.src = `a${id}.jpg`;
                img.className = 'building-img';
                
                const zone = document.createElement('div');
                zone.className = 'chair-drop-zone';
                zone.id = `zone-A${id}`; 
                zone.ondrop = (e) => drop(e, zone);
                zone.ondragover = allowDrop;

                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'style-input';
                input.id = `input-A${id}`;
                input.placeholder = translations[currentLang].placeholder;

                card.appendChild(img);
                card.appendChild(zone);
                card.appendChild(input);
                
                container.insertBefore(card, submitContainer);
            });

            // Chairs
            shuffledChairs.forEach(id => {
                const img = document.createElement('img');
                img.src = `c${id}.png`;
                img.id = `C${id}`;
                img.className = 'chair-item';
                img.draggable = true;
                img.ondragstart = drag;
                img.addEventListener('touchstart', handleTouchStart, {passive: false});
                img.addEventListener('touchmove', handleTouchMove, {passive: false});
                img.addEventListener('touchend', handleTouchEnd);
                
                pool.appendChild(img);
            });
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // --- RESULTS LOGIC ---
        function checkResults() {
            let score = 0;
            const resultsList = document.getElementById('results-list');
            resultsList.innerHTML = '';
            const t = translations[currentLang];

            // 1 to 16 Chronological
            for (let i = 1; i <= 16; i++) {
                const zone = document.getElementById(`zone-A${i}`);
                const input = document.getElementById(`input-A${i}`);
                const db = gameDB.find(item => item.id === i);

                let userChairSrc = null;
                let isCorrect = false;

                if (zone.children.length > 0) {
                    const chairId = zone.children[0].id; 
                    userChairSrc = zone.children[0].src;
                    
                    if (chairId === `C${i}`) {
                        isCorrect = true;
                        score++;
                    }
                }

                const itemDiv = document.createElement('div');
                itemDiv.className = `result-item ${isCorrect ? 'correct' : 'incorrect'}`;

                const styleName = currentLang === 'ua' ? db.styleUA : db.styleEN;
                const archDesc = currentLang === 'ua' ? db.archUA : db.archEN;
                const chairDesc = currentLang === 'ua' ? db.chairUA : db.chairEN;

                const userText = input.value.trim() || "—";

                itemDiv.innerHTML = `
                    <div class="result-header">${styleName}</div>
                    <div class="result-grid">
                        <div class="res-img-block">
                            <img src="a${i}.jpg" class="res-img b-img">
                            <div>${t.labels.arch}</div>
                        </div>
                        <div class="res-img-block">
                            <img src="c${i}.png" class="res-img">
                            <div>${t.labels.correct}</div>
                        </div>
                        <div class="res-img-block">
                            <div style="width:auto; height:160px; display:flex; align-items:center; justify-content:center; margin: 0 auto;">
                                ${userChairSrc ? `<img src="${userChairSrc}" class="res-img">` : `<span style="color:#bdc3c7; font-size:20px; border:1px dashed #d0d7de; border-radius:8px; width:100px; height:100px; display:flex; align-items:center; justify-content:center;">?</span>`}
                            </div>
                            <div>${t.labels.yourChoice}</div>
                        </div>
                    </div>
                    <div class="user-input-display">${t.labels.yourStyle}: <b>${userText}</b></div>
                    <div class="result-details">
                        <b>${t.labels.style}:</b> ${styleName}<br>
                        <b>${t.labels.arch}:</b> ${archDesc}<br>
                        <b>${t.labels.chair}:</b> ${chairDesc}
                    </div>
                `;
                resultsList.appendChild(itemDiv);
            }

            let finalMsg = "";
            for (let s of t.scores) {
                if (score <= s.max) {
                    finalMsg = s.text;
                    break;
                }
            }

            document.getElementById('score-val').innerText = `${score} / 16`;
            document.getElementById('score-msg').innerText = finalMsg;
            
            document.getElementById('game-view').style.display = 'none';
            document.getElementById('results-view').style.display = 'flex';
            
            window.scrollTo(0,0);
        }

        function resetGame() {
            document.getElementById('results-view').style.display = 'none';
            document.getElementById('game-view').style.display = 'flex';
            initGame();
        }

        // --- DRAG & DROP LOGIC ---
        function allowDrop(ev) {
            ev.preventDefault();
            if (ev.target.classList.contains('chair-drop-zone')) ev.target.classList.add('drag-over');
        }
        document.addEventListener('dragleave', (ev) => {
            if (ev.target.classList.contains('chair-drop-zone')) ev.target.classList.remove('drag-over');
        });
        function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }
        
        function drop(ev, zone) {
            ev.preventDefault();
            zone.classList.remove('drag-over');
            var data = ev.dataTransfer.getData("text");
            var draggedElement = document.getElementById(data);
            if (!draggedElement) return;
            placeItemInZone(draggedElement, zone);
        }
        function dropToPool(ev) {
            ev.preventDefault();
            var data = ev.dataTransfer.getData("text");
            var draggedElement = document.getElementById(data);
            if (draggedElement) returnToPool(draggedElement);
        }

        // --- MOBILE TOUCH LOGIC ---
        let touchDragItem = null;
        let originalParent = null;
        let startX = 0, startY = 0;

        function handleTouchStart(e) {
            touchDragItem = e.target;
            originalParent = touchDragItem.parentElement;
            const t = e.touches[0];
            startX = t.clientX; startY = t.clientY;
        }

        function handleTouchMove(e) {
            if (!touchDragItem) return;
            const t = e.touches[0];
            const dx = Math.abs(t.clientX - startX);
            const dy = Math.abs(t.clientY - startY);

            if (!touchDragItem.classList.contains('dragging-mobile')) {
                if (originalParent.id === 'chairs-pool' && dx > dy) return;
                if (dy > 5) {
                    touchDragItem.classList.add('dragging-mobile');
                    document.body.appendChild(touchDragItem);
                }
            }
            if (touchDragItem.classList.contains('dragging-mobile')) {
                e.preventDefault();
                touchDragItem.style.left = t.clientX + 'px';
                touchDragItem.style.top = t.clientY + 'px';
            }
        }

        function handleTouchEnd(e) {
            if (!touchDragItem) return;
            if (!touchDragItem.classList.contains('dragging-mobile')) { touchDragItem = null; return; }

            const t = e.changedTouches[0];
            touchDragItem.style.display = 'none';
            let el = document.elementFromPoint(t.clientX, t.clientY);
            touchDragItem.style.display = 'block';

            let dropZone = el ? el.closest('.chair-drop-zone') : null;
            let poolZone = el ? el.closest('#chairs-pool') : null;

            touchDragItem.classList.remove('dragging-mobile');
            Object.assign(touchDragItem.style, {left:'', top:'', position:'', zIndex:'', width:'', height:'', background:'', border:'', borderRadius:''});

            if (dropZone) placeItemInZone(touchDragItem, dropZone);
            else if (poolZone) returnToPool(touchDragItem);
            else if (originalParent && originalParent.classList.contains('chair-drop-zone')) placeItemInZone(touchDragItem, originalParent);
            else returnToPool(touchDragItem);
            
            touchDragItem = null;
        }

        function placeItemInZone(item, zone) {
            if (zone.children.length > 0 && zone.children[0] !== item) returnToPool(zone.children[0]);
            if (item.parentElement.classList.contains('chair-drop-zone')) item.parentElement.classList.remove('has-item');
            zone.appendChild(item);
            zone.classList.add('has-item');
        }

        function returnToPool(item) {
            if (item.parentElement.classList.contains('chair-drop-zone')) item.parentElement.classList.remove('has-item');
            document.getElementById('chairs-pool').appendChild(item);
        }

        // --- START ---
        initGame();
        setLanguage('ua'); // Default

    </script>
</body>
</html>
